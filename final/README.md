## Machine Learning Final Project (2019, Spring)
RSNA Pneumonia Detection Challenge (DeepQ Challenge)

**by NTU_r07943107_**

# Directory structure

- `src`: folder of source codes including all .py files
- `requirements`: python3 package requirements. Please try to install all the packages listed.
- `train_50.sh`: perform training. Use resnet50 for the backbone.
- `train_101.sh`: perform training. Use resnet101 for the backbone.
- `train_152.sh`: perform training. Use resnet152 for the backbone.
- `setup.sh`: set up the environments for dataset, not packages.
- `test.sh`: make inferences. Before making any inferences, please make sure that the environments are set up properly.
- `submissions`: folder to hold output files generated by `./test.sh`

# Software 
(python3 packages are detailed separately in `requirements.txt`):

- Python 3.6.x (required)
- Ubuntu 18.04 LTS or CentOS 7 (optional)
- CUDA 9.0 (optional)
- cuDNN 7.0.5 (optional)
- NVIDIA driver v.390.116 (optional)

# Data and keras-retinanet setup 
(assumes the [Kaggle API](https://github.com/Kaggle/kaggle-api) is installed and configured)

Run the following shell commands from the top level directory

	cd data
	kaggle competitions download -c rsna-pneumonia-detection-challenge
	unzip stage_2_test_images.zip -d stage_2_test_images
	unzip stage_2_train_images.zip -d stage_2_train_images
	cd ../keras-retinanet
	python setup.py build_ext --inplace
	cd ..
	python prepare_data.py

Note that `settings.json` is configured for creating training and validation sets from the Stage 1 training labels, which are what I used to train the models for the competition.  I did not perform any training on the Stage 2 training set, which included Stage 1 test images.

# Model Training

There are two RetinaNets used in my solution, which are trained by the following scripts.

	./train50.sh
	./train101.sh

Snapshots after each epoch of training are saved in `snapshots`.  For the competition, I manually selected the best snapshots from several runs based on the precision score and maximum Youden index reported during training. 


# Making Prediction

	python3 predict.py <prediction_fpath>

    Example: python3 predict.py prediction.csv

Output .csv is saved to `./submissions` folder
